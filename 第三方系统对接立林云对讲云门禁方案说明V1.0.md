|  |
|---|


![{85BE12DD-03EE-40FF-8CC6-07FF179E7356}](media/580afccce0b1b45f44842ea42c775e4a.png)

    **密级**

    内部文件、保密

|   | **文档名称** | 立林IOT平台---设备接入系统方案 |   |   |
|---|--------------|--------------------------------|---|---|


**第三方系统对接立林云对讲云门禁及智能家居方案说明**

| 版本 | 版本说明 | 作者/ 修改者 | 日期 |
|------|----------|--------------|------|
|      |          |              |      |
|      |          |              |      |
|      |          |              |      |
|      |          |              |      |
|      |          |              |      |

**目录**

[1. 适用范围 1](#适用范围)

[2. 系统拓扑 1](#系统拓扑)

[3. 相关约束 2](#相关约束)

[3.1. 对接立林云对讲云门禁 2](#对接立林云对讲云门禁)

>   [3.1.1. 立林系统维护(系统维护人员操作) 2](#立林系统维护系统维护人员操作)

>   [3.1.2. 第三方系统要求 2](#第三方系统要求)

[4. 立林云对讲云门禁功能说明 2](#立林云对讲云门禁功能说明)

[4.1. 上传社区和房屋结构、获取设备信息 2](#上传社区和房屋结构获取设备信息)

>   [4.1.1. 流程图 3](#流程图)

>   [4.1.2. 流程描述 3](#流程描述)

>   [4.1.3. 提供接口 3](#提供接口)

[4.2. 上报开门事件 3](#上报开门事件)

>   [4.2.1. 时序图 4](#时序图-1)

>   [4.2.2. 流程描述 4](#流程描述-2)

>   [4.2.3. 提供接口 4](#提供接口-2)

[4.3. 住户变更（门禁变更） 4](#住户变更门禁变更)

>   [4.3.1. 时序图 5](#时序图-3)

>   [4.3.2. 流程描述 5](#流程描述-4)

>   [4.3.3. 提供接口 5](#提供接口-4)

[4.4. 住户人脸变更 6](#住户人脸变更)

>   [4.4.1. 时序图 6](#时序图-4)

>   [4.4.2. 流程描述 7](#流程描述-5)

>   [4.4.3. 提供接口 8](#提供接口-5)

[4.5. 开门密码变更 8](#开门密码变更)

>   [4.5.1. 时序图 8](#时序图-5)

>   [4.5.2. 流程描述 8](#流程描述-6)

>   [4.5.3. 提供接口 9](#提供接口-6)

[4.6. 社区通知 9](#社区通知)

>   [4.6.1. 时序图 9](#时序图-6)

>   [4.6.2. 流程描述 9](#流程描述-7)

>   [4.6.3. 提供接口 9](#提供接口-7)

[4.7. 设备指令下发 10](#设备指令下发远程开门)

>   [4.7.1. 时序图 10](#时序图-7)

>   [4.7.2. 流程描述 10](#流程描述-8)

>   [4.7.3. 提供接口 10](#提供接口-8)

[5. 文档介绍 10](#文档介绍)

适用范围
========

>   本文档适用于第三方APP对接立林平台的云对讲、云门禁（包括二维码和蓝牙，可自动包括梯控对接）等功能，第三方需满足以下条件：

1.  第三方已有（完善或在开发）独立的APP整套系统，包括手机APP和云平台

2.  第三方需有技术开发团队进行相关对接及沟通

系统拓扑
========

相关约束
========

对接立林云对讲云门禁
--------------------

### 立林系统维护(系统维护人员操作)

1.  每个小区必须安装相应的立林综合管理软件，且软件所在的电脑必须要能上互联网。

2.  综合物业软件需配置好完整的房间楼层关系。以对讲系统中的**房间号**为准，即**8位字符串，规则：如01020304**，表示：01幢02单元03层04号房间。

    1.  第三方系统要求

3.  第三方需按小区进行管理。立林平台为每个真实的小区分配一个12位的小区号。该号码线下提供，需配置到第三方的小区管理中，作为关系配对。

4.  第三方的账号需与立林平台进行账号对接及授权：需要以下重要信息（**仔细阅读**）

5.  第三方系统的账号ID需要到立林云交换同步的立林账号，用于后续的接口交互以及传入SDK，第三方系统的账号ID在第三方系统中唯一

6.  第三方系统需为自己的每个账号配对立林的小区号及房间号，即账号是属于XXXXXXXXXXXX小区YYYYYYYY房间。即，立林的房间号规则，如上红色字体所述。第三方需按规则配置好，并调用平台的Restful
    api进行关联。

7.  如第三方有云对讲对接功能，需提供推送的相关信息

8.  IOS需申请并提供该APP包名下的相关VOIP的推送证书

9.  Android
    需提供该APP包名下的第三方推送的相关信息，推荐使用：小米，极光，华为等多家推送信息

立林云对讲云门禁功能说明
========================

上传社区和房屋结构、获取设备信息
--------------------------------

1.  流程图

2.  流程描述

3.  前置条件：物业人员在立林物业软件配置好基础数据，包括房屋结构信息和设备信息，菜单：首页-\>系统管理-\>基础数据

4.  前置条件：第三方提供房屋信息上报URL，在物业软件预先配置好 url

5.  第三方云http请求立林云上报指定小区的房屋信息，立林云发送通知到对应的立林物业软件

6.  立林物业软件开始进行http请求上报，上报的房屋信息包括房屋结构和设备信息。

7.  立林云提供获取设备信息的接口

    1.  提供接口

| **接口名**               | **接口URL**                       | **说明**          |
|--------------------------|-----------------------------------|-------------------|
| 请求物业全量上报房屋信息 | /rest/api/third/doStructureReport | 第三方-\>立林云   |
| 第三方接收全量上报信息   | 由第三方提供                      | 物业软件-\>第三方 |
| 获取门禁设备列表接口     | /rest/api/third/getDoorList       | 第三方-\>立林云   |

详细见接口文档

上报设备运行状态
----------------

1.  时序图

2.  流程描述

3.  第三方提供上报设备在线状态URL给立林

4.  物业每间隔一段时间会对所有设备进行巡检，上报所有设备的设备在线状态

    1.  提供接口

| **接口名**   | **接口URL**  | **说明**         |
|--------------|--------------|------------------|
| 上报设备状态 | 由第三方提供 | 物业软件\>第三方 |

详细见接口文档

上报开门事件
------------

1.  时序图

2.  流程描述

3.  第三方提供上报开门记录URL给立林

4.  当有主机开门时，综合物业软件实时上报开门记录到立林云，立林云根据第三方提供的URL，http上报到第三方云

    1.  提供接口

| **接口名**             | **接口URL**  | **说明**       |
|------------------------|--------------|----------------|
| 第三方接收上报门禁记录 | 由第三方提供 | 立林云\>第三方 |

详细见接口文档

上报人员采集信息 "IC/ID、卡指纹、人脸"
--------------------------------------

1.  时序图

2.  流程描述

3.  前置条件：预先配置全量上报URL和

4.  第三方云可以调用立林云接口通知物业全量上报人员信息

5.  当物业本地人员信息发生变动时，会http发送变更内容给第三方云

    1.  提供接口

| **接口名**               | **接口URL**                        | **说明**                                            |
|--------------------------|------------------------------------|-----------------------------------------------------|
| 第三方接收全量上报信息   | 由第三方提供                       | 物业软件-\>第三方，同上报社区和房屋接口，关键字区分 |
| 请求物业全量上报人员信息 | /rest/api/third/doPersonInfoReport | 第三方-\>立林云                                     |
|                          |                                    |                                                     |

详细见接口文档

住户变更（门禁变更）
--------------------

1.  时序图

2.  流程描述

3.  第三方云用自己的账号，向立林云交换立林账号，第三方维护自己账号和立林云账号的关系，需确保传入账号的唯一性。

4.  住户变更时，使用获得的立林账号调用立林云接口，绑定/解绑变更住家以及住家上的权限。

5.  使用获得的立林账号传入SDK，SDK与立林云建立连接，根据绑定信息及权限，提供云对讲，门禁功能，门禁功能包括蓝牙和二维码，详细见SDK提供文档

6.  SDK的使用，需要立林云配置第三方的推送信息。

7.  关于门禁权限，立林云提供无SDK二维码获取接口，配置好门禁权限后，调用无sdk接口然后返回的值使用javascript即生成二维码图片开门

    1.  提供接口

| **接口名**                | **接口URL**                            | **说明**                                  |
|---------------------------|----------------------------------------|-------------------------------------------|
| 第三方APP账号注册/同步    | /rest/api/third/user/sync              | 第三方\>立林云                            |
| 配置账号业务权限          | /rest/api/third/members/save           | 第三方\>立林云                            |
| 删除账号业务权限          | /rest/api/third/members/delete         | 第三方\>立林云                            |
| 获取二维码信息接口(无SDK) | /rest/api/third/generated/qrcode/query | 第三方\>立林云 可用于H5页面生成二维码图片 |

详细见接口文档

SDK接口见SDK相关文档

住户人脸变更
------------

1.  时序图

2.  流程描述

3.  当住户人脸发生变更时，第三方云调用立林云接口，上传图片，立林云返回图片url。

4.  第三方云携带图片url以及立林账号，调用立林云接口注册人脸到指定住家，
    立林云与物业软件通行，物业软件下发人脸卡到该住家关联的所有门禁设备。

5.  用户即可以通过人脸识别打开门禁设备

    1.  提供接口

| **接口名**         | **接口URL**                    | **说明**       |
|--------------------|--------------------------------|----------------|
| 第三方上传图片接口 | /rest/api/third/picture/upload | 第三方\>立林云 |
| 注册人脸           | /rest/api/third/face/register  | 第三方\>立林云 |
| 注销人脸           | /rest/api/third/face/cancel    | 第三方\>立林云 |

详细见接口文档

开门密码变更
------------

1.  时序图

2.  流程描述

3.  第三方携带住家号，立林账号等信息调用立林云获取动态密码接口，

4.  立林云通过物业软件下发动态密码到住家对应的所有设备

5.  下发成功立林云返回6位数字动态密码

6.  动态密码可以设置有效期，使用次数，目前没有提供删除接口。

    1.  提供接口

| **接口名**   | **接口URL**                   | **说明**       |
|--------------|-------------------------------|----------------|
| 获取动态密码 | /rest/api/third/getDynamicPwd | 第三方\>立林云 |

详细见接口文档

社区通知
--------

1.  时序图

2.  流程描述

3.  当需要发送通知时，第三方携带住家号，通知内容等信息调用立林云消息发布接口，

4.  立林云通过物业软件下发消息到住家对应的所有设备

5.  下发成功立林云应答成功

    1.  提供接口

| **接口名** | **接口URL**                | **说明**       |
|------------|----------------------------|----------------|
| 消息发布   | /rest/api/third/releaseMsg | 第三方\>立林云 |

详细见接口文档

设备指令下发（远程开门）
------------------------

1.  时序图

2.  流程描述

3.  第三方携带住家号，设备号等信息调用立林云远程开门接口，

4.  立林云发送到物业软件，物业软件控制对应设备

5.  调用成功立林云应答成功

    1.  提供接口

| **接口名**   | **接口URL**              | **说明**       |
|--------------|--------------------------|----------------|
| 远程开门接口 | /rest/api/third/opendoor | 第三方\>立林云 |

详细见接口文档

文档介绍
========

1.  第三方系统对接立林云门禁云对讲-V0.1.pdf

>   该文档为平台对平台调用的Restful api 接口文档，

1.  立林云对讲Android_SDK_V1.0.rar, 立林云门禁Android_SDK_V1.0.rar

>   分别为安卓手机的云对讲和云门禁的SDK，里面有相关说明文档

1.  立林云对讲IOS_SDK_V1.0.rar ， 立林云门禁IOS_SDK_V1.1.rar

>   分别为苹果手机的云对讲和云门禁的SDK，里面有相关说明文档
